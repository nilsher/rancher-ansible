---

- name: Install prerequisites
  apt:
    name: ['ca-certificates']
    update_cache: yes
  become: yes

- name: Add postgress apt key
  apt_key:
    url: https://www.postgresql.org/media/keys/ACCC4CF8.asc
    state: present
  become: yes

- name: Add postgres APT repository
  apt_repository:
    repo: deb [arch=amd64] http://apt.postgresql.org/pub/repos/apt/ {{ansible_distribution_release}}-pgdg main
  become: yes

- name: "Install pgsql {{pgsql_version}}"
  apt:
    pkg:
    -  "postgresql={{pgsql_version}}"
  become: yes

- name: Enable pinned pgsql version
  template:
    src: "pgsql.pref.j2"
    dest: "/etc/apt/preferences.d/pgsql.pref"
    owner: "root"
    group: "root"
    mode: "0644"
  become: yes
